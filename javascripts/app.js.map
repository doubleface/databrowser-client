{"version":3,"sources":["app/application.js","app/initialize.js","app/models/menu.js","app/views/main.js","app/views/menu.js"],"names":["Router","Backbone","extend","routes","onDoctype","doctype","app","views","main","setDoctype","menu","select","initialize","$el","appendTo","router","history","start","$","on","$aside","isExpanded","attr","window","Collection","model","Model","fetch","Promise","resolve","reject","cozysdk","queryView","group","then","reset","result","catch","err","attrToString","_","isObject","i","View","el","collection","listenTo","render","getCols","json","length","console","log","push","title","data","defaultContent","html","toJSON","config","destroy","lengthChange","dom","buttons","scrollX","scrollY","deferRender","scroller","columns","DataTable","toLowerCase","error","map","record","value","bind","itemTemplate","template","forEach","sclass","key","selected","empty","removeClass","addClass"],"mappings":"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","file":"public/javascripts/app.js","sourcesContent":["import MenuView from \"views/menu\";\nimport MainView from \"views/main\";\n\nvar Router = Backbone.Router.extend({\n    routes: {\n        \"doctype/:doctype\": \"onDoctype\"\n    },\n    onDoctype(doctype){\n        this.app.views.main.setDoctype(doctype);\n        this.app.views.menu.select(doctype);\n    }\n});\n\nvar app = {\n    initialize() {\n        this.views = {\n            menu: new MenuView(),\n            main: new MainView()\n        };\n        this.views.menu.$el.appendTo(\"#container\");\n        this.views.main.$el.appendTo(\"#container\");\n        this.router = new Router({\n            app: this\n        });\n        this.router.app = this;\n        Backbone.history.start();\n\n        $(\"[formaction='drawer/toggle']\").on(\"click\", () => {\n            const $aside = $(\"aside\")\n            const isExpanded = $aside.attr(\"aria-expanded\") === \"true\" ? \"false\" : \"true\";\n            $aside.attr(\"aria-expanded\", isExpanded);\n        });\n    }\n}\n\nvar router = new Router();\n\nexport default app\n\n","import app from \"application\";\n\nwindow.app = app;\n\n$(() => app.initialize());\n","export default Backbone.Collection.extend({\n    model: Backbone.Model,\n    fetch() {\n        return new Promise((resolve, reject) => {\n            window.cozysdk.queryView(\"doctypes\", \"getsums\", { group: true })\n            .then(result => {\n                this.reset(result);\n                resolve(result);\n            }).catch(err => {\n                reject(err);\n            });\n        });\n    }\n});\n","function attrToString(attr) {\n    if (!_(attr).isObject()) return attr;\n    else {\n        let result = '<ul>';\n        for (let i in attr) {\n            result+= `<li>${attrToString(attr[i])}</li>`;\n        }\n        result+= '</ul>';\n        return result;\n    }\n}\n\nexport default Backbone.View.extend({\n    el: \"[role='contentinfo']\",\n    collection: new Backbone.Collection(),\n    initialize() {\n        this.listenTo(this.collection, \"reset\", this.render);\n    },\n    getCols(json) {\n        var result = [];\n        if (json.length === 0) return result;\n        console.log(json[0], \"record used to get columns\");\n        for (var i in json[0]) {\n            result.push({\n                title: i,\n                data: i,\n                defaultContent: \"\"\n            });\n        }\n        return result;\n    },\n    render() {\n        this.$el.html('<table></table>');\n        var json = this.collection.toJSON();\n        var config = {\n            destroy: true,\n            lengthChange: false,\n            dom: '<\"thead\"Bfi>t',\n            buttons: [\n                'colvis'\n            ],\n            scrollX: \"100%\",\n            scrollY: \"calc(100vh - 7em)\",\n            deferRender: true,\n            scroller: true,\n            data: json,\n            columns: this.getCols(json)\n        };\n        this.$(\"table\").DataTable(config);\n        return this;\n    },\n    setDoctype(doctype){\n        this.doctype = doctype;\n        cozysdk.queryView(doctype.toLowerCase(), \"all\", {}, (err, data) => {\n            if (err) return console.error(err, \"error while fetching doctype\");\n            this.collection.reset(data.map(record => record.value));\n        });\n    }\n});\n","import Collection from \"models/menu\";\n\nexport default Backbone.View.extend({\n    el: \"aside\",\n    collection: new Collection(),\n    initialize() {\n        this.collection.fetch()\n        .then(this.render.bind(this))\n        .catch(err => console.error(err, \"error while fetching menu collection\"));\n    },\n    itemTemplate: _.template('<li><a class=\"<%= sclass %>\" href=\"#doctype/<%= key %>\"><%= key %> (<%= value %>)</a></li>'),\n    render() {\n        var html = \"<ul>\";\n        this.collection.forEach((model) => {\n            var json = model.toJSON();\n            json.sclass = json.key === this.selected ? \"selected\" : \"\";\n            html+= this.itemTemplate(json);\n        }, this);\n        html+= \"</ul>\";\n        this.$el.empty().html(html);\n        return this;\n    },\n    select(doctype) {\n        this.selected = doctype;\n        this.$(\"a\").removeClass(\"selected\");\n        this.$(\"a[href='#doctype/\" + doctype + \"']\").addClass(\"selected\");\n    }\n});\n"]}