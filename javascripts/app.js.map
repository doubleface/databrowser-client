{"version":3,"sources":["app/application.js","app/initialize.js","app/models/menu.js","app/views/main.js","app/views/menu.js"],"names":["Router","Backbone","extend","routes","onDoctype","doctype","app","views","main","setDoctype","menu","select","initialize","$el","appendTo","router","history","start","$","on","$aside","isExpanded","attr","window","Collection","model","Model","fetch","Promise","resolve","reject","cozysdk","queryView","group","then","reset","result","catch","err","attrToString","_","isObject","i","View","el","collection","listenTo","render","getCols","json","length","push","title","data","defaultContent","html","toJSON","config","destroy","lengthChange","dom","buttons","scrollX","scrollY","deferRender","scroller","columns","DataTable","url","bind","console","error","itemTemplate","template","forEach","sclass","key","selected","empty","removeClass","addClass"],"mappings":"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","file":"public/javascripts/app.js","sourcesContent":["import MenuView from \"views/menu\";\nimport MainView from \"views/main\";\n\nvar Router = Backbone.Router.extend({\n    routes: {\n        \"doctype/:doctype\": \"onDoctype\"\n    },\n    onDoctype(doctype){\n        this.app.views.main.setDoctype(doctype);\n        this.app.views.menu.select(doctype);\n    }\n});\n\nvar app = {\n    initialize() {\n        this.views = {\n            menu: new MenuView(),\n            main: new MainView()\n        };\n        this.views.menu.$el.appendTo(\"#container\");\n        this.views.main.$el.appendTo(\"#container\");\n        this.router = new Router({\n            app: this\n        });\n        this.router.app = this;\n        Backbone.history.start();\n\n        $(\"[formaction='drawer/toggle']\").on(\"click\", () => {\n            const $aside = $(\"aside\")\n            const isExpanded = $aside.attr(\"aria-expanded\") === \"true\" ? \"false\" : \"true\";\n            $aside.attr(\"aria-expanded\", isExpanded);\n        });\n    }\n}\n\nvar router = new Router();\n\nexport default app\n\n","import app from \"application\";\n\nwindow.app = app;\n\n$(() => app.initialize());\n","export default Backbone.Collection.extend({\n    model: Backbone.Model,\n    fetch() {\n        return new Promise((resolve, reject) => {\n            window.cozysdk.queryView(\"doctypes\", \"getsums\", {group: true})\n            .then(result => {\n                this.reset(result);\n                resolve(result);\n            })\n            .catch(err => {\n                reject(err);\n            });\n        });\n    }\n});\n","function attrToString(attr) {\n    if (!_(attr).isObject()) return attr;\n    else {\n        let result = '<ul>';\n        for (let i in attr) {\n            result+= `<li>${attrToString(attr[i])}</li>`;\n        }\n        result+= '</ul>';\n        return result;\n    }\n}\n\nexport default Backbone.View.extend({\n    el: \"[role='contentinfo']\",\n    collection: new Backbone.Collection(),\n    initialize() {\n        this.listenTo(this.collection, \"reset\", this.render);\n    },\n    getCols(json) {\n        var result = [];\n        if (json.length === 0) return result;\n        for (var i in json[0]) {\n            result.push({\n                title: i,\n                data: i,\n                defaultContent: \"\"\n            });\n        }\n        return result;\n    },\n    render() {\n        this.$el.html('<table></table>');\n        var json = this.collection.toJSON();\n        var config = {\n            destroy: true,\n            lengthChange: false,\n            dom: '<\"thead\"Bfi>t',\n            buttons: [\n                'colvis'\n            ],\n            scrollX: \"100%\",\n            scrollY: \"calc(100vh - 7em)\",\n            deferRender: true,\n            scroller: true,\n            data: json,\n            columns: this.getCols(json)\n        };\n        this.$(\"table\").DataTable(config);\n        return this;\n    },\n    setDoctype(doctype){\n        this.doctype = doctype;\n        this.collection.fetch({\n            reset: true,\n            url: \"search?range=all&doctypes[]=\" + doctype\n        });\n    }\n});\n","import Collection from \"models/menu\";\n\nexport default Backbone.View.extend({\n    el: \"aside\",\n    collection: new Collection(),\n    initialize() {\n        this.collection.fetch()\n            .then(this.render.bind(this))\n            .catch(err => console.error(err, \"error while fetching menu collection\"));\n    },\n    itemTemplate: _.template('<li><a class=\"<%= sclass %>\" href=\"#doctype/<%= key %>\"><%= key %> (<%= value %>)</a></li>'),\n    render() {\n        var html = \"<ul>\";\n        this.collection.forEach((model) => {\n            var json = model.toJSON();\n            json.sclass = json.key === this.selected ? \"selected\" : \"\";\n            html+= this.itemTemplate(json);\n        }, this);\n        html+= \"</ul>\";\n        this.$el.empty().html(html);\n        return this;\n    },\n    select(doctype) {\n        this.selected = doctype;\n        this.$(\"a\").removeClass(\"selected\");\n        this.$(\"a[href='#doctype/\" + doctype + \"']\").addClass(\"selected\");\n    }\n});\n"]}